# Celery Configuration Example
# Copy this to your .env file and customize as needed

#=============================================================================
# REDIS CONFIGURATION
#=============================================================================

# Redis connection settings
REDIS_HOST=localhost
REDIS_PORT=6379

# Separate Redis databases for broker and backend
# Using different databases improves performance
REDIS_DB_BROKER=0       # Database for message broker (task queue)
REDIS_DB_BACKEND=1      # Database for result storage

# Redis password (if authentication is enabled)
# REDIS_PASSWORD=your_redis_password

#=============================================================================
# CELERY WORKER CONFIGURATION
#=============================================================================

# Logging level: debug, info, warning, error, critical
CELERY_LOG_LEVEL=info

# Number of concurrent worker processes
# Set based on CPU cores: 2-4 per core is typical
CELERY_CONCURRENCY=4

# Maximum tasks a worker can execute before being replaced
# Helps prevent memory leaks
CELERY_MAX_TASKS_PER_CHILD=1000

#=============================================================================
# EMAIL TASK CONFIGURATION
#=============================================================================

# Email batch processing settings
EMAIL_BATCH_SIZE=50         # Emails per batch
EMAIL_BATCH_DELAY=2         # Seconds between batches

# Email rate limiting
EMAIL_RATE_LIMIT=50/m       # 50 emails per minute

#=============================================================================
# SCRAPER TASK CONFIGURATION
#=============================================================================

# Scraper timeouts and limits
SCRAPER_TIMEOUT=300         # 5 minutes (in seconds)
SCRAPER_RETRY_DELAY=120     # 2 minutes between retries
SCRAPER_MAX_RESULTS=100     # Default max results per scrape

# Scraper rate limiting
SCRAPER_RATE_LIMIT=10/m     # 10 scrapes per minute

#=============================================================================
# AI TASK CONFIGURATION
#=============================================================================

# AI processing timeouts
AI_TIMEOUT=180              # 3 minutes
AI_RETRY_DELAY=60           # 1 minute between retries

# AI rate limiting
AI_RATE_LIMIT=30/m          # 30 AI requests per minute

# AI model settings
AI_MODEL=gpt-3.5-turbo      # OpenAI model to use
AI_MAX_TOKENS=2000          # Max tokens per request

#=============================================================================
# DEMO TASK CONFIGURATION
#=============================================================================

# Demo generation timeouts
DEMO_TIMEOUT=1800               # 30 minutes
VIDEO_PROCESSING_TIMEOUT=3600   # 1 hour

# Demo storage
DEMO_STORAGE_PATH=/tmp/demos
DEMO_CDN_URL=https://cdn.fliptechpro.com

#=============================================================================
# FLOWER MONITORING CONFIGURATION
#=============================================================================

# Flower web UI settings
FLOWER_PORT=5555
FLOWER_ADDRESS=0.0.0.0

# Flower authentication (recommended for production)
# FLOWER_BASIC_AUTH=user:password

#=============================================================================
# PERFORMANCE TUNING
#=============================================================================

# Worker prefetch settings
# Number of tasks to reserve per worker
CELERY_WORKER_PREFETCH_MULTIPLIER=4

# Task result expiration
# How long to keep task results in Redis (in seconds)
CELERY_RESULT_EXPIRES=3600  # 1 hour

# Connection pool settings
CELERY_BROKER_POOL_LIMIT=10
CELERY_REDIS_MAX_CONNECTIONS=50

#=============================================================================
# PRODUCTION SETTINGS
#=============================================================================

# Enable task events for monitoring
CELERY_SEND_TASK_EVENTS=true
CELERY_TRACK_STARTED=true

# Timezone
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=true

# Task compression (saves bandwidth)
# CELERY_TASK_COMPRESSION=gzip
# CELERY_RESULT_COMPRESSION=gzip

#=============================================================================
# DEBUGGING
#=============================================================================

# Enable debug mode for development
# CELERY_DEBUG=true

# Log task arguments (disable in production for security)
# CELERY_WORKER_LOG_FORMAT=[%(asctime)s: %(levelname)s/%(processName)s] %(message)s

#=============================================================================
# NOTES
#=============================================================================

# - Use separate Redis instances for production (broker vs backend)
# - Adjust CELERY_CONCURRENCY based on your CPU cores and workload
# - Set appropriate rate limits to avoid overwhelming external services
# - Monitor memory usage and adjust MAX_TASKS_PER_CHILD if needed
# - Use Flower for real-time monitoring in production
# - Consider using Redis Sentinel or Cluster for high availability
